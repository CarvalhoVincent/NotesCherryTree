<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Pass the Ticket w/ mimikatz</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Pass the Ticket w/ mimikatz</h1><br/>             Mimikatz  is a very popular and powerful post-exploitation tool most commonly  used for dumping user credentials inside of an active directory network  however we&#39;ll be using mimikatz in order to dump a TGT from LSASS memory<br />This  will only be an overview of how the pass the ticket attacks work as THM  does not currently support networks but I challenge you to configure  this on your own network.<br />You  can run this attack on the given machine however you will be escalating  from a domain admin to a domain admin because of the way the domain  controller is set up.<br /><h2>Pass the Ticket Overview -</h2> <br />Pass  the ticket works by dumping the TGT from the LSASS memory of the  machine. The Local Security Authority Subsystem Service (LSASS) is a  memory process that stores credentials on an active directory server and  can store Kerberos ticket along with other credential types to act as  the gatekeeper and accept or reject the credentials provided. You can  dump the Kerberos Tickets from the LSASS memory just like you can dump  hashes. When you dump the tickets with mimikatz it will give us a .kirbi  ticket which can be used to gain domain admin if a domain admin ticket  is in the LSASS memory. This attack is great for privilege escalation  and lateral movement if there are unsecured domain service account  tickets laying around. The attack allows you to escalate to domain admin  if you dump a domain admin&#39;s ticket and then impersonate that ticket  using mimikatz PTT attack allowing you to act as that domain admin. You  can think of a pass the ticket attack like reusing an existing ticket  were not creating or destroying any tickets here were simply reusing an  existing ticket from another user on the domain and impersonating that  ticket.<br /><br /><br /><a href="https://i.imgur.com/V6SOlll.png"><img src="images/71-1.png" alt="images/71-1.png" /></a><br /><br /><br /><h2>Prepare Mimikatz &amp; Dump Tickets - </h2> <br />You  will need to run the command prompt as an administrator: use the same  credentials as you did to get into the machine. If you don&#39;t have an  elevated command prompt mimikatz will not work properly.<br />1.) <code>cd Downloads</code> - navigate to the directory mimikatz is in<br />2.) <code>mimikatz.exe</code> - run mimikatz<br />3.) <code>privilege::debug</code> -  Ensure this outputs [output &#39;20&#39; OK] if it does not that means you do  not have the administrator privileges to properly run mimikatz<br /><a href="https://i.imgur.com/SJQGplV.png"><img src="images/71-2.png" alt="images/71-2.png" /></a><br />4.) <code>sekurlsa::tickets /export</code> - this will export all of the .kirbi tickets into the directory that you are currently in<br />At this step you can also use the base 64 encoded tickets from Rubeus that we harvested earlier<br /><a href="https://i.imgur.com/xC0L5Kf.png"><img src="images/71-3.png" alt="images/71-3.png" /></a><br />When  looking for which ticket to impersonate I would recommend looking for  an administrator ticket from the krbtgt just like the one outlined in  red above.<br /><h2>Pass the Ticket w/ Mimikatz</h2><br />Now that we have our ticket ready we can now perform a pass the ticket attack to gain domain admin privileges.<br />1.) <code>kerberos::ptt &lt;ticket&gt;</code> -  run this command inside of mimikatz with the ticket that you harvested  from earlier. It will cache and impersonate the given ticket<br /><a href="https://i.imgur.com/DwXmm8Z.png"><img src="images/71-4.png" alt="images/71-4.png" /></a><br />2.) <code>klist</code> - Here were just verifying that we successfully impersonated the ticket by listing our cached tickets. <br />We will not be using mimikatz for the rest of the attack.<br /><a href="https://i.imgur.com/GgxDm9k.png"><img src="images/71-5.png" alt="images/71-5.png" /></a><br />3.)  You now have impersonated the ticket giving you the same rights as the  TGT you&#39;re impersonating. To verify this we can look at the admin share.<br /><a href="https://i.imgur.com/9nxjeTS.png"><img src="images/71-6.png" alt="images/71-6.png" /></a><br />Note  that this is only a POC to understand how to pass the ticket and gain  domain admin the way that you approach passing the ticket may be  different based on what kind of engagement you&#39;re in so do not take this  as a definitive guide of how to run this attack.<br /><h2>Pass the Ticket Mitigation -</h2><br />Let&#39;s talk blue team and how to mitigate these types of attacks. <br />• Don&#39;t  let your domain admins log onto anything except the domain controller -  This is something so simple however a lot of domain admins still log  onto low-level computers leaving tickets around that we can use to  attack and move laterally with.<br /><br /><br /><br />        <br /></div></body></html>