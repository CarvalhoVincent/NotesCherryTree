<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>AS-REP Roasting w/ Rubeus</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>AS-REP Roasting w/ Rubeus</h1><br/>             Very  similar to Kerberoasting, AS-REP Roasting dumps the krbasrep5 hashes of  user accounts that have Kerberos pre-authentication disabled. Unlike  Kerberoasting these users do not have to be service accounts the only  requirement to be able to AS-REP roast a user is the user must have  pre-authentication disabled.<br />We&#39;ll  continue using Rubeus same as we have with kerberoasting and harvesting  since Rubeus has a very simple and easy to understand command to AS-REP  roast and attack users with Kerberos pre-authentication disabled. After  dumping the hash from Rubeus we&#39;ll use hashcat in order to crack the  krbasrep5 hash.<br />There  are other tools out as well for AS-REP Roasting such as kekeo and  Impacket&#39;s GetNPUsers.py. Rubeus is easier to use because it  automatically finds AS-REP Roastable users whereas with GetNPUsers you  have to enumerate the users beforehand and know which users may be  AS-REP Roastable.<br />I have already compiled and put Rubeus on the machine.<br /><h2>AS-REP Roasting Overview - </h2><br /><small>During  pre-authentication, the users hash will be used to encrypt a timestamp  that the domain controller will attempt to decrypt to validate that the  right hash is being used and is not replaying a previous request. After  validating the timestamp the KDC will then issue a TGT  for the user. If pre-authentication is disabled you can request any  authentication data for any user and the KDC will return an encrypted  TGT that can be cracked offline because the KDC skips the step of  validating that the user is really who they say that they are.</small><br /><a href="https://i.imgur.com/arAImcA.png"><img src="images/70-1.png" alt="images/70-1.png" /></a><br /><h2>Dumping KRBASREP5 Hashes w/ Rubeus -</h2><br />1.) <code>cd Downloads</code> - navigate to the directory Rubeus is in<br />2.) <code>Rubeus.exe asreproast</code> - This will run the AS-REP roast command looking for vulnerable users and then dump found vulnerable user hashes.<br /><a href="https://i.imgur.com/l3wJhby.png"><img src="images/70-2.png" alt="images/70-2.png" /></a><br /><h2>Crack those Hashes w/ hashcat - </h2><br />1.) Transfer the hash from the target machine over to your attacker machine and put the hash into a txt file<br />2.) Insert 23$ after $krb5asrep$ so that the first line will be $krb5asrep$23$User.....<br />Use the same wordlist that you downloaded in task 4<br />3.) <code>hashcat -m 18200 hash.txt Pass.txt</code> - crack those hashes! Rubeus AS-REP Roasting uses hashcat mode 18200 <br /><a href="https://i.imgur.com/eOqGVrm.png"><img src="images/70-3.png" alt="images/70-3.png" /></a><br /><h2>AS-REP Roasting Mitigations - </h2><br />• Have a strong password policy. With a strong password, the hashes will take longer to crack making this attack less effective<br /><br />◇ Don&#39;t  turn off Kerberos Pre-Authentication unless it&#39;s necessary there&#39;s  almost no other way to completely mitigate this attack other than  keeping Pre-Authentication on.<br /><br /><br />        <br /></div></body></html>