<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Windows</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Windows</h1><br/><br /><br /><br />                                                                                        <br />  View all the privileges using whoami /priv<br />  <br />  You can see that two  privileges(SeDebugPrivilege, SeImpersonatePrivilege) are enabled. Let&#39;s  use the incognito module that will allow us to exploit this  vulnerability. Enter: <em>load incognito </em>to load the incognito module in metasploit. Please note, you may need to use the <em>use incognito </em>command if the previous command doesn&#39;t work. Also ensure that your metasploit is up to date.<br /><br /><br />Here are the most commonly abused privileges:<br />• SeImpersonatePrivilege<br />• SeAssignPrimaryPrivilege<br />• SeTcbPrivilege<br />• SeBackupPrivilege<br />• SeRestorePrivilege<br />• SeCreateTokenPrivilege<br />• SeLoadDriverPrivilege<br />• SeTakeOwnershipPrivilege<br />• SeDebugPrivilege<br /><br /><br /> <br /> To check which tokens are available, enter the <em><strong>list_tokens -g</strong></em>. We can see that the <em>BUILTIN\Administrators</em> token is available. Use the <em><strong>impersonate_token &quot;BUILTIN\Administrators&quot;</strong></em> command to impersonate the Administrators token. What is the output when you run the <em><strong>getuid</strong></em> command?<br />                                                        <br />  Even though you have a higher  privileged token you may not actually have the permissions of a  privileged user (this is due to the way Windows handles permissions - it  uses the Primary Token of the process and not the impersonated token to  determine what the process can or cannot do). Ensure that you <strong>migrate </strong> to a process with correct permissions (above questions answer). The  safest process to pick is the services.exe process. First use the <em><strong>ps</strong></em><em> </em>command to view processes and find the PID of the services.exe process. Migrate to this process using the command <em>migrate PID-OF-PROCESS</em><br />                            <br />                        <br />                          <br />                        Infos utiles:<br /><a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens">https://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens</a><br /><a href="https://www.exploit-db.com/papers/42556">https://www.exploit-db.com/papers/42556</a><br />                                                                                       <br /><br /><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br />                                                                        <br /><br /></div></body></html>