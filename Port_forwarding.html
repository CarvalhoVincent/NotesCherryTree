<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Port forwarding</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Port forwarding</h1><br/><br /><br /><h3>To use local port forwarding with SSH , you can use the ssh command with the -L option, followed by the</h3><br /><h3>local port, remote host and port, and the remote SSH server. For example, the following command will</h3><br /><h3>forward traffic from the local port 1234 to the remote server remote.example.com &#39;s localhost interface</h3><br /><h3>on port 22 :</h3><br /><br /><br /><br />Sur la target deja connect√© en ssh:<br /><br /><div class="codebox"><div class="codebox">ssh&nbsp;-L&nbsp;1234:localhost:5432&nbsp;christine@{target_IP}</div></div><br /><br /><br /><a href=""><img src="images/89-1.png" alt="images/89-1.png" /></a><br /><br /><h3>When you run this command, the SSH client will establish a secure connection to the remote SSH server,</h3><br /><h3>and it will listen for incoming connections on the local port 1234 . When a client connects to the local port,</h3><br /><h3>the SSH client will forward the connection to the remote server on port 22 . This allows the local client to</h3><br /><h3>access services on the remote server as if they were running on the local machine.</h3><br /><h3>In the scenario we are currently facing, we want to forward traffic from any given local port, for instance</h3><br /><h3>1234 , to the port on which PostgreSQL is listening, namely 5432 , on the remote server. We therefore</h3><br /><h3>specify port 1234 to the left of localhost , and 5432 to the right, indicating the target port.</h3><br /><br /><br /><br /><br />Puis sur la machine locale:<br /><br /><div class="codebox"><div class="codebox">psql&nbsp;-U&nbsp;christine&nbsp;-h&nbsp;localhost&nbsp;-p&nbsp;1234</div></div><br /><br /><br />------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br /><br /><br /><br /><br /><br /><br /><br /><br /><h2>Dynamic Port Forwarding</h2><br /><br /><br /><br /><br /><h3>Instead of local port forwarding, we could have also opted for dynamic port forwarding, again using SSH .</h3><br /><h3>Unlike local port forwarding and remote port forwarding, which use a specific local and remote port (earlier</h3><br /><h3>we used 1234 and 5432 , for instance), dynamic port forwarding uses a single local port and dynamically</h3><br /><h3>assigns remote ports for each connection.</h3><br /><br /><br /><h3>To use dynamic port forwarding with SSH, you can use the ssh command with the -D option, followed by</h3><br /><h3>the local port, the remote host and port, and the remote SSH server. For example, the following command</h3><br /><h3>will forward traffic from the local port 1234 to the remote server on port 5432, where the PostgreSQL server</h3><br /><h3>is running:</h3><br /><br /><br /><div class="codebox"><div class="codebox">ssh&nbsp;-D&nbsp;1234&nbsp;christine@{target_IP}</div></div><br /><br /><br /><h3>Again, we can use the -f and -N flags so we don&#39;t actually SSH into the box, and can instead</h3><br /><h3>continue using that shell locally.</h3><br /><br /><br /><h3>As you can see, this time around we specify a single local port to which we will direct all the traffic needing</h3><br /><h3>forwarding. If we now try running the same psql command as before, we will get an error.</h3><br /><br /><br /><br /><br /><a href=""><img src="images/89-2.png" alt="images/89-2.png" /></a><br /><br /><h3>That is because this time around we did not specify a target port for our traffic to be directed to, meaning</h3><br /><h3>psql is just sending traffic into the established local socket on port 1234 , but never reaches the</h3><br /><h3>PostgreSQL service on the target machine.</h3><br /><br /><br /><h3>To make use of dynamic port forwarding, a tool such as proxychains is especially useful. In summary and</h3><br /><h3>as the name implies, proxychains can be used to tunnel a connection through multiple proxies; a use case</h3><br /><h3>for this could be increasing anonymity, as the origin of a connection would be significantly more difficult to</h3><br /><h3>trace. In our case, we would only tunnel through one such &quot;proxy&quot;; the target machine.</h3><br /><h3>The tool is pre-installed on most pentesting distributions (such as ParrotOS and Kali Linux ) and is highly</h3><br /><h3>customisable, featuring an array of strategies for tunneling, which can be tampered with in its configuration</h3><br /><h3>file /etc/proxychains4.conf .</h3><br /><h3>The minimal changes that we have to make to the file for proxychains to work in our current use case is</h3><br /><h3>to:</h3><br /><h3>1. Ensure that strict_chain is not commented out; ( dynamic_chain and random_chain should be</h3><br /><h3>commented out)</h3><br /><h3>2. At the very bottom of the file, under [ProxyList] , we specify the socks5 (or socks4 ) host and port</h3><br /><h3>that we used for our tunnel</h3><br /><h3>In our case, it would look something like this, as our tunnel is listening at localhost:1234 .</h3><br /><br /><br /><h3>Having configured proxychains correctly, we can now connect to the PostgreSQL service on the target, as</h3><br /><h3>if we were on the target machine ourselves! This is done by prefixing whatever command we want to run</h3><br /><h3>with proxychains , like so:</h3><br /><br /><br /><div class="codebox"><div class="codebox">proxychains&nbsp;psql&nbsp;-U&nbsp;christine&nbsp;-h&nbsp;localhost&nbsp;-p&nbsp;5432</div></div><br /><br /><br /><h3>Proxychains can produce an unusual amount of output, but don&#39;t be intimidated by it, it is just verbose</h3><br /><h3>in showing you whether a certain connection to a proxy worked or not.</h3><br /><h3>This should hopefully demonstrate the beauty of dynamic port forwarding, as we can specify the target port</h3><br /><h3>freely and in accord with each command we want to run. If we wanted to cURL a webserver on port 80 , for</h3><br /><h3>instance, during local port forwarding we would have to run the tunneling command all over again and</h3><br /><h3>change up the target port. Here, we can simply prefix our cURL command with proxychains , and access</h3><br /><h3>the webserver as if we were on the target machine ourselves; no need for any extra specification- hence,</h3><br /><h3>dynamic.</h3></div></body></html>