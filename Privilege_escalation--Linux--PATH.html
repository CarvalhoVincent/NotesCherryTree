<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>PATH</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>PATH</h1><br/><br /><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;<span style="color:#7f0044;font-weight:400">$PATH</span><br /><span style="color:#ff9d00;font-weight:700">find</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>&nbsp;-writable&nbsp;2&gt;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>null<br /><span style="color:#ff9d00;font-weight:700">export</span>&nbsp;<span style="color:#7f0044;font-weight:400">PATH</span>=<span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#7f0044;font-weight:400">$PATH</span></div></div><br /><br /><br /><br /><br /><br /><br />If a folder for which your user has write permission is located  in the path, you could potentially hijack an application to run a  script. PATH in Linux  is an environmental variable that tells the operating system where to  search for executables. For any command that is not built into the shell  or that is not defined with an absolute path, Linux will start  searching in folders defined under PATH. (PATH is the environmental  variable we&#39;re talking about here, path is the location of a file).<br /><br />Typically the PATH will look like this:<br /><a href="https://i.imgur.com/ch2Z4zp.png"><img src="images/42-1.png" alt="images/42-1.png" /></a><br /><br />If we type “thm” to the command line, these are the locations Linux  will look in for an executable called thm. The scenario below will give  you a better idea of how this can be leveraged to increase our  privilege level. As you will see, this depends entirely on the existing  configuration of the target system, so be sure you can answer the  questions below before trying this.<br />1. What folders are located under $PATH<br />2. Does your current user have write privileges for any of these folders?<br />3. Can you modify $PATH?<br />4. Is there a script/application you can start that will be affected by this vulnerability?<br />For demo purposes, we will use the script below:<br /><br /><a href="https://i.imgur.com/qX7m2Jq.png"><img src="images/42-2.png" alt="images/42-2.png" /></a><br /><br /> This script tries to launch a system binary called “thm” but the example can easily be replicated with any binary.  <br /><br />  <br />We compile this into an executable and set the SUID bit.  <br /><br /><br /><a href="https://i.imgur.com/A6QQ65I.png"><img src="images/42-3.png" alt="images/42-3.png" /></a><br /><br /> Our user now has access to the “path” script with SUID bit set.<br /><br /><br /><br /><br /><a href="https://i.imgur.com/Af1RpuY.png"><img src="images/42-4.png" alt="images/42-4.png" /></a><br /><br /><br /><br /> Once executed “path” will look for an executable named “thm” inside folders listed under PATH.  <br /><br />  <br />If any writable folder is listed under PATH we could create a binary named thm under that directory and have our “path” script run it. As the SUID bit is set, this binary will run with root privilege<br /><br />  <br /><br />  <br />A simple search for writable folders can done using the “<code>find / -writable 2&gt;/dev/null</code>” command. The output of this command can be cleaned using a simple cut and sort sequence.<br /><br /><br /><a href="https://i.imgur.com/7UekB3t.png"><img src="images/42-5.png" alt="images/42-5.png" /></a><br /><br /><br /><br /> Some CTF scenarios can present different folders but a regular system would output something like we see above.  <br />Comparing this with PATH will help us find folders we could use.  <br /><br /><br /><a href="https://i.imgur.com/67mdmmG.png"><img src="images/42-6.png" alt="images/42-6.png" /></a><br />  <br /><br />We see a number of folders under /usr, thus it could be easier to run our writable folder search once more to cover subfolders.  <br /><br /><br /><br /><br /><a href="https://i.imgur.com/Y3pDsrL.png"><img src="images/42-7.png" alt="images/42-7.png" /></a><br /><br /><br /><br /> An alternative could be the command below.  <br /><code>find / -writable 2&gt;/dev/null | cut -d &quot;/&quot; -f 2,3 | grep -v proc | sort -u</code><br />We have added “grep -v proc” to get rid of the many results related to running processes.<br /><br />  <br />Unfortunately, subfolders under /usr are not writable<br /><br />  <br />The folder that will be easier to write to is probably /tmp. At this point because /tmp is not present in PATH so we will need to add it. As we can see below, the “<code>export PATH=/tmp:$PATH</code>” command accomplishes this.  <br /><br /><br /><a href="https://i.imgur.com/u1PM8ZD.png"><img src="images/42-8.png" alt="images/42-8.png" /></a><br /><br /><br /><br /> At this point the path script will also look under the /tmp folder for an executable named “thm”.  <br />Creating this command is fairly easy by copying /bin/bash as “thm” under the /tmp folder.  <br /><br /><br /><a href="https://i.imgur.com/7UdrEnd.png"><img src="images/42-9.png" alt="images/42-9.png" /></a><br /><br /><br /><br /> We have given executable rights to our copy of /bin/bash, please note that at this point it will run with our user’s right. What makes a privilege escalation possible within this context is that the path script runs with root privileges.  <br /><br /><br /><a href="https://i.imgur.com/MlBJ8kb.png"><img src="images/42-10.png" alt="images/42-10.png" /></a><br /></div></body></html>