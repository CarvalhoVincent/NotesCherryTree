<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Docker Compose</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Docker Compose</h1><br/>             Let’s first understand what Docker Compose is and why it’s worth understanding. So far, we’ve only interacted with containers individually. Docker Compose, in summary, allows multiple containers (or applications) to interact with each other when needed while running in isolation from one another.<br /><br /><br />You may have noticed a problem with Docker so far. More often than not, applications require additional services to run, which we cannot do in a single container. For example, modern - dynamic - websites use services such as databases and a web server. For the sake of this task, we will consider each application as a “microservice”.<br /><br /><br />While we can spin up multiple containers or “microservices” individually and connect them, doing so one by one is cumbersome and inefficient. Docker Compose allows us to create these “microservices” as one singular “service”. <br /><br /><br />This illustration shows how containers are deployed together using Docker Compose Vs. Docker:<br /><br /><br /><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/c7c8b38dc06c22207134fb6f58d036a0.png"><img src="images/84-1.png" alt="images/84-1.png" /></a><br /><br /><br />Before we demonstrate Docker Compose, let’s cover the fundamentals of using Docker Compose.<br />1. <small>We  need Docker Compose installed (it does not come with Docker by  default). Installing it is out of scope for this room, as it changes  depending on your operating system and other factors. You can check out  the installation documentation </small><a href="https://docs.docker.com/compose/install/">here</a><small>.</small><br /><br />2. We need a valid <em>docker-compose.yml</em> file - we will come onto this shortly.<br />3. A fundamental understanding of using Docker Compose to build and manage containers.<br />I have put some of the essential Docker Compose commands into the table below:<br /><br /><table class="table"><tr><th>Command</th><th>Explanation</th><th>Example</th></tr><tr><td>up</td><td>This command will (re)create/build and start the containers specified in the compose file.</td><td>docker-compose up</td></tr><tr><td>start</td><td>This command will start (but requires the containers already being built) the containers specified in the compose file.</td><td>docker-compose start</td></tr><tr><td>down</td><td>This command will stop and delete the containers specified in the compose file.</td><td>docker-compose down</td></tr><tr><td>stop</td><td>This command will stop (not delete) the containers specified in the compose file.</td><td>docker-compose stop</td></tr><tr><td>build</td><td>This command will build (but will not start) the containers specified in the compose file.</td><td>docker-compose build</td></tr></table><br /><br /><br /><br /><em><h3>﻿</h3></em><em><strong><h3>Note</h3></strong></em><em><h3>: These are just a few of the possible commands. Check out the </h3></em><a href="https://docs.docker.com/compose/reference/">compose documentation</a><em><h3> for all possible options.</h3></em><br /><h2>A Showcase of Docker Compose</h2><br /><small>With  that said, let’s look into how we can use Docker Compose ourselves. In  this scenario, I am going to assume the following requirements:</small><br />1. <small>An E-commerce website running on Apache</small><br />2. <small>This E-commerce website stores customer information in a MySQL database</small><br />Now, we could manually run the two containers via the following:<br />1. Creating the network between the two containers: <code>docker network create ecommerce</code><br />2. Running the Apache2 webserver container: <code>docker run -p 80:80 --name webserver --net ecommerce webserver</code><br />3. Running the MySQL Database server: <code>docker run --name database --net ecommerce webserver</code><br /><br /><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/4f236c94f79474475f2dc5df15146c91.png"><img src="images/84-2.png" alt="images/84-2.png" /></a><br /><br /><br /><em>An illustration shows two containers running independently of each other and is </em><em><strong>unable</strong></em><em> to communicate with one another.</em><br />…but  do we want to do this every time? Or what if we decide to scale up and  get many web servers involved? Do we want to do this for every  container, every time? I certainly don’t.<br />Instead, we can use Docker Compose via <code>docker-compose up</code> to run these containers together, giving us the advantages of:<br />1. One simple command to run them both<br />2. These two containers are networked together, so we don’t need to go about configuring the network.<br />3. Extremely portable. We can share our <em>docker-compose.yml</em> file with someone else, and they can get the setup working precisely the same without understanding how the containers work individually.<br />4. Easy to maintain and change. We don’t have to worry about specific containers using (perhaps outdated) images.<br /><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/21ba7a242ec9660be9694e69ec4c33e6.png"><img src="images/84-3.png" alt="images/84-3.png" /></a><br /><em>An illustration showing two containers deployed as a combined service. These two containers </em><em><strong>can </strong></em><em>communicate with one another.</em><br /><h2>Docker-compose.yml files 101</h2><br />One file to rule them all. The formatting of a <em>docker-compose.yml</em> file is different to that of a Dockerfile. It is important to note that YAML  requires indentation (a good practice is two spaces which must be  consistent!). First, I’ll show some of the new instructions that you  will need to learn to be able to write a <em>docker-compose.yml</em> file before we go into creating a <em>docker-compose.yml </em>file:<br /><table class="table"><tr><th>Instruction</th><th>Explanation</th><th>Example</th></tr><tr><td>version</td><td>This is placed at the top of the file and is used to identify what version of Compose the docker-compose.yml is written for.</td><td>&#39;3.3&#39;</td></tr><tr><td>services</td><td>This instruction marks the beginning of the containers to be managed.</td><td>services:</td></tr><tr><td>name (replace value)</td><td>This instruction is where you define the container and its configuration. &quot;name&quot; needs to be replaced with the actual name of the container you want to define, i.e. &quot;webserver&quot; or &quot;database&quot;.</td><td>webserver</td></tr><tr><td>build</td><td>This instruction defines the directory containing the Dockerfile for this container/service. (you will need to use this or an image).</td><td>./webserver</td></tr><tr><td>ports</td><td>This instruction publishes ports to the exposed ports (this depends on the image/Dockerfile).</td><td>&#39;80:80&#39;</td></tr><tr><td>volumes</td><td>This instruction lists the directories that should be mounted into the container from the host operating system.</td><td>&#39;./home/cmnatic/webserver/:/var/www/html&#39;</td></tr><tr><td>environment</td><td>This instruction is used to pass environment variables (not secure), i.e. passwords, usernames, timezone configurations, etc.</td><td>MYSQL_ROOT_PASSWORD=helloworld</td></tr><tr><td>image</td><td>This instruction defines what image the container should be built with (you will need to use this or build).</td><td>mysql:latest</td></tr><tr><td>networks</td><td>This instruction defines what networks the containers will be a part of. Containers can be part of multiple networks (i.e. a web server can only contact one database, but the database can contact multiple web servers).</td><td>ecommerce</td></tr></table><br /><em><strong>Note</strong></em><em>: These are just some of the possible instructions possible. Check out the </em><a href="https://docs.docker.com/compose/compose-file/">compose file</a><em> documentation for all possible instructions.</em><br />With that said, let’s look at our first docker-compose.yml file. This <em>docker-compose.yml</em> file assumes the following:<br />1. We will run one web server (named web) from the previously mentioned scenario.<br />2. We will run a database server (named database) from the previously mentioned scenario.<br />3. The web server is going to be built using its Dockerfile, but we are going to use an already-built image for the database server (MySQL)<br />4. The containers will be networked to communicate with each other (the network is called ecommerce).<br />5. Our directory listing looks like the following:<br />6.  docker-compose.yml<br />7. web/Dockerfile<br />Here is what our docker-compose.yml file would look like (as a reminder, it is essential to pay attention to the indentation):<br /><code>version: &#39;3.3&#39;<br />services:<br />  web:<br />    build: ./web<br />    networks:<br />      - ecommerce<br />    ports:<br />      - &#39;80:80&#39;<br /><br /><br />  database:<br />    image: mysql:latest<br />    networks:<br />      - ecommerce<br />    environment:<br />      - MYSQL_DATABASE=ecommerce<br />      - MYSQL_USERNAME=root<br />      - MYSQL_ROOT_PASSWORD=helloword<br />    <br />networks:<br />  ecommerce:</code><br />        <br /></div></body></html>