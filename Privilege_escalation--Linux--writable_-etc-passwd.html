<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>writable /etc/passwd</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>writable /etc/passwd</h1><br/><strong>Exploiting a writable /etc/passwd</strong><br /><br />Continuing with the enumeration of users, we found that <strong>user7 </strong>is a member of the <strong>root</strong> group with <strong>gid 0.</strong> And we already know from the <strong>LinEnum</strong> scan that <strong>/etc/passwd</strong> file is writable for the user. So from this observation, we concluded that <strong>user7 </strong>can edit the /etc/passwd file. <br /><strong>Understanding /etc/passwd</strong><br />The /etc/passwd file stores essential information, which  is required during login. In other words, it stores user account  information. The /etc/passwd is a <strong>plain text file</strong>. It contains a list of  the system’s accounts, giving for each account some useful information  like user ID, group ID, home directory, shell, and more. <br />The  /etc/passwd  file should have general read permission as many command utilities use  it to map user IDs to user names. However, write access to the  /etc/passwd must only limit for the superuser/root account. When it  doesn&#39;t, or a user has erroneously been added to a write-allowed group.  We have a vulnerability that can allow the creation of a root user that  we can access. <br /><strong>Understanding /etc/passwd format</strong><br />The  /etc/passwd file contains one entry per line for each user (user  account) of the system. All fields are separated by a colon : symbol.  Total of seven fields as follows. Generally, /etc/passwd file entry  looks as follows:<br />    test:x:0:0:root:/root:/bin/bash<br />[as divided by colon (:)]<br /><br />1. <strong>Username</strong>: It is used when user logs in. It should be between 1 and 32 characters in length.<br />2. <strong>Password</strong>: An x character indicates that encrypted password is stored in /etc/shadow file. Please note that you need to use the passwd command to compute the hash of a password typed at the CLI or to store/update the hash of the password in /etc/shadow file, in this case, the password hash is stored as an &quot;x&quot;.<br /><br />3. <strong>User ID (UID)</strong>:  Each user must be assigned a user ID (UID). UID 0 (zero) is reserved  for root and UIDs 1-99 are reserved for other predefined accounts.  Further UID 100-999 are reserved by system for administrative and system  accounts/groups.<br />4. <strong>Group ID (GID)</strong>: The primary group ID (stored in /etc/group file)<br />5. <strong>User ID Info</strong>: The comment field. It allow you to add extra information about the users such as user’s full name, phone number etc. This field use by finger command.<br />6. <strong>Home directory</strong>: The absolute path to the directory the user will be in when they log in. If this directory does not exists then users directory becomes /<br />7. <strong>Command/shell</strong>: The absolute path of a command or shell (/bin/bash). Typically, this is a shell. Please note that it does not have to be a shell.<br /><strong>How to exploit a writable /etc/passwd</strong><br />It&#39;s  simple really, if we have a writable /etc/passwd file, we can write a  new line entry according to the above formula and create a new user! We  add the password hash of our choice, and set the UID, GID and shell to root. Allowing us to log in as our own root user!<br /><br />--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br /><br />Before we add our new user, we first need to create a compliant password hash to add! We do this by using the command: <br /><br /><strong><h3>&quot;openssl passwd -1 -salt [salt] [password]&quot;</h3></strong><br /><br /><br />What is the hash created by using this command with the salt, <strong>&quot;new&quot;</strong> and the password <strong>&quot;123&quot;</strong>?<br /><br />                                                                                           <br /> Great! Now we need to take this  value, and create a new root user account. What would the /etc/passwd  entry look like for a root user with the username &quot;new&quot; and the password  hash we created before?<br /><br />                                                                                                                    <br /> Great! Now you&#39;ve got everything you need. Just add that entry to the end of the /etc/passwd file!<br /><br />                                                                                        <br />Now, use <strong>&quot;su&quot; </strong>to login as the  &quot;new&quot; account, and then enter the password. If you&#39;ve done everything  correctly- you should be greeted by a root prompt! Congratulations! <br /><br /></div></body></html>