<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>nmap--scripts</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>nmap--scripts</h1><br/><br />The <strong>N</strong>map <strong>S</strong>cripting <strong>E</strong>ngine (NSE) is an incredibly  powerful addition to Nmap, extending its functionality quite  considerably. NSE Scripts are written in the <em>Lua </em>programming  language, and can be used to do a variety of things: from scanning for  vulnerabilities, to automating exploits for them. The NSE is  particularly useful for reconnaisance, however, it is well worth bearing  in mind how extensive the script library is.<br />There are many categories available. Some useful categories include:<br />• <code>safe</code>:- Won&#39;t affect the target<br />• <code>intrusive</code>:- Not safe: likely to affect the target<br /><br />• <code>vuln</code>:- Scan for vulnerabilities<br />• <code>exploit</code>:- Attempt to exploit a vulnerability<br />• <code>auth</code>:- Attempt to bypass authentication for running services (e.g. Log into an FTP server anonymously)<br />• <code>brute</code>:- Attempt to bruteforce credentials for running services<br />• <code>discovery</code>:- Attempt to query running services for further information about the network (e.g. query an SNMP server).<br /><br />A more exhaustive list can be found <a href="https://nmap.org/book/nse-usage.html">here</a>.<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />             In Task 3 we looked very briefly at the <code>--script</code> switch for activating NSE scripts from the <code>vuln</code> category using <code>--script=vuln</code>. It should come as no surprise that the other categories work in exactly the same way. If the command <code>--script=safe</code>  is run, then any applicable safe scripts will be run against the target  (Note: only scripts which target an active service will be activated).<br /><br /><br />To run a specific script, we would use <code>--script=&lt;script-name&gt; </code> , e.g. <code>--script=http-fileupload-exploiter</code>.<br />Multiple scripts can be run simultaneously in this fashion by separating them by a comma. For example: <code>--script=smb-enum-users,smb-enum-shares</code>.<br />Some scripts require arguments (for example, credentials, if they&#39;re  exploiting an authenticated vulnerability). These can be given with the <code>--script-args</code> Nmap switch. An example of this would be with the <code>http-put</code>  script (used to upload files using the PUT method). This takes two  arguments: the URL to upload the file to, and the file&#39;s location on  disk.  <br /><br />For example:<br /><br /><code>nmap -p 80 --script http-put --script-args http-put.url=&#39;/dav/shell.php&#39;,http-put.file=&#39;./shell.php&#39;</code><br /><br /><br />Note that the arguments are separated by commas, and connected to the corresponding script with periods (i.e.  <code>&lt;script-name&gt;.&lt;argument&gt;</code>).<br /><br />A full list of scripts and their corresponding arguments (along with example use cases) can be found <a href="https://nmap.org/nsedoc/">here</a>.<br />Nmap scripts come with built-in help menus, which can be accessed using <code>nmap --script-help &lt;script-name&gt;</code>. This tends not to be as extensive as in the link given above, however, it can still be useful when working locally.<br /><br />        <br /><br /><br /><br /><br /><br />Ok, so we know how to use the scripts in Nmap, but we don&#39;t yet know how to <em>find</em> these scripts.<br />We have two options for this, which should ideally be used in conjunction with each other. The first is the page on the <a href="https://nmap.org/nsedoc/">Nmap website</a>  (mentioned in the previous task) which contains a list of all official  scripts. The second is the local storage on your attacking machine. Nmap  stores its scripts on Linux at <code>/usr/share/nmap/scripts</code>. All of the NSE scripts are stored in this directory by default -- this is where Nmap looks for scripts when you specify them. <br />There are two ways to search for installed scripts. One is by using the <code>/usr/share/nmap/scripts/script.db</code>  file. Despite the extension, this isn&#39;t actually a database so much as a  formatted text file containing filenames and categories for each  available script.<br /><a href="https://i.imgur.com/aJdVSAP.png"><img src="images/61-1.png" alt="images/61-1.png" /></a><br /><br /> Nmap uses this file to keep track of (and utilise) scripts for the scripting engine; however, we can also <em>grep </em>through it to look for scripts. For example: <code>grep &quot;ftp&quot; /usr/share/nmap/scripts/script.db</code>.<br /><br /><a href="https://i.imgur.com/ijAhZsy.png"><img src="images/61-2.png" alt="images/61-2.png" /></a><br /><br />The second way to search for scripts is quite simply to use the <code>ls</code> command. For example, we could get the same results as in the previous screenshot by using <code>ls -l /usr/share/nmap/scripts/*ftp*</code>:<br /><a href="https://i.imgur.com/7GV9Wzi.png"><img src="images/61-3.png" alt="images/61-3.png" /></a><br /><br /><em>Note the use of asterisks</em> (<code>*</code>) <em>on either side of the search term</em><br />The same techniques can also be used to search for categories of script. For example:<br /><code>grep &quot;safe&quot; /usr/share/nmap/scripts/script.db</code><br /><br /><a href="https://i.imgur.com/352GgTj.png"><img src="images/61-4.png" alt="images/61-4.png" /></a><br /><br /><br /><em><span style="text-decoration:underline;">Installing New Scripts</span></em><br />We mentioned previously that the Nmap website contains a list of scripts, so, what happens if one of these is missing in the <code>scripts</code> directory locally? A standard <code>sudo apt update &amp;&amp; sudo apt install nmap</code> should fix this; however, it&#39;s also possible to install the scripts manually by downloading the script from Nmap (<code>sudo wget -O /usr/share/nmap/scripts/&lt;script-name&gt;.nse https://svn.nmap.org/nmap/scripts/&lt;script-name&gt;.nse</code>). This must then be followed up with <code>nmap --script-updatedb</code>, which updates the <code>script.db</code> file to contain the newly downloaded script.<br />It&#39;s  worth noting that you would require the same &quot;updatedb&quot; command if you  were to make your own NSE script and add it into Nmap -- a more than  manageable task with some basic knowledge of Lua! <br /></div></body></html>